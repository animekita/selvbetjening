{% extends "sadmin/base/extendedsite.html" %}
{% load i18n humanize %}

{% block content_title %}<h2>{% trans "Financial Report" %}</h2>{% endblock %}

{% block content %}

<form method="POST" action="">{% csrf_token %}

{% for fieldset in adminformattingform %}
      {% include "admin/includes/fieldset.html" %}
{% endfor %}

    <div class="submit-row" >
    <input type="submit" value="Update report" class="default" name="do_show" />
    </div>
</form>

<h3>Oversigt</h3>
<fieldset class="module aligned ">
<table style="width: 100%;">

<tr class="form-row type">
    <th></th>
    <th>Overbetalt</th>
    <th>Betalt</th>
    <th>Delvist betalt</th>
    <th>Ikke betalt</th>
    <th>Total</th>
</tr>

{% for line_group in line_groups %}

<tr class="form-row type line_group" style="font-size: 0.7em;">
    <td>{{line_group.name}}</td>
    <td>{{line_group.overpaid|length}} ({{line_group.overpaid_total | intcomma}},-)</td>
    <td>{{line_group.paid|length}} ({{line_group.paid_total | intcomma}},-)</td>
    <td>{{line_group.partial|length}} ({{line_group.partial_total | intcomma}},-)</td>
    <td>{{line_group.unpaid|length}} ({{line_group.unpaid_total | intcomma}},-)</td>
    <td>{{line_group.lines|length}} ({{line_group.total | intcomma}},-)</td>
</tr>

{% endfor %}

<tr class="form-row type line_group" style="font-size: 0.7em;">
    <td><b>Total</b></td>
    <td><b>({{total.overpaid | intcomma}},-)</b></td>
    <td><b>({{total.paid | intcomma}},-)</b></td>
    <td><b>({{total.partial | intcomma}},-)</b></td>
    <td><b>({{total.unpaid | intcomma}},-)</b></td>
    <td><b>({{total.total | intcomma}},-)</b></td>
</tr>

</table>
</fieldset>

{% if detailed_view %}

<h3>Detaljeret opg√∏relse</h3>
<fieldset class="module aligned ">
<table style="width: 100%;">

<tr class="form-row type">
    <th></th>
    <th>Overbetalt</th>
    <th>Betalt</th>
    <th>Delvist betalt</th>
    <th>Ikke betalt</th>
    <th>Total</th>
</tr>

{% for line_group in line_groups %}

<tr class="form-row type line_group" style="font-size: 0.7em;">
    <td><b>{{line_group.name}}</b></td>
    <td>{{line_group.overpaid|length}} ({{line_group.overpaid_total | intcomma}},-)</td>
    <td>{{line_group.paid|length}} ({{line_group.paid_total | intcomma}},-)</td>
    <td>{{line_group.partial|length}} ({{line_group.partial_total | intcomma}},-)</td>
    <td>{{line_group.unpaid|length}} ({{line_group.unpaid_total | intcomma}},-)</td>
    <td>{{line_group.lines|length}} ({{line_group.total | intcomma}},-)</td>
</tr>

{% for line in line_group.lines %}
<tr style="font-size: 0.7em;">
    <td>{{line.invoice.user}}</td>

    <td>{% if line.invoice.is_overpaid %}x{% endif %}</td>
    <td>{% if line.invoice.in_balance %}x{% endif %}</td>
    <td>{% if line.invoice.is_partial %}x{% endif %}</td>
    <td>{% if line.invoice.is_unpaid %}x{% endif %}</td>

    <td>{{line.price}},-</td>
</tr>
{% endfor %}


{% endfor %}

{% endif %}


</table>
</fieldset>
{% endblock %}