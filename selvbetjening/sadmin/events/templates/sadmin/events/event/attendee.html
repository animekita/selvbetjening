{% extends "sadmin/events/base.html" %}
{% load uni_form_tags %}

{% block page_heading %}
<h1>Tilmelding til {{ event.title }}</h1>
<h2>{{ attendee.user.first_name }} {{ attendee.user.last_name }} ({{ attendee.user.username}})</h2>
{% endblock %}

{% block navigation %}
    <nav class="secondary-nav">
     <ul>
       <li><a href="#status">Status</a></li>
       <li><a href="#billing">Betalinger</a></li>
       <li><a href="#selections">Tilvalg</a></li>
     </ul>
    </nav>
{% endblock %}

{% block content %}

<h3 id="status">Status</h3>

<form method="POST" action="" class="uniForm">

<table>
<tr>
    <td>Tilmelding</td>
    <td>{{attendee_form.state}}</td>
</tr>
<tr>
    <td>Betaling</td>
    {% if attendee.invoice.in_balance %}
        <td>Betalt</td>
    {% else %}{% if attendee.invoice.is_paid %}
        <td>Betalt for meget</td>
    {% else %}
        <td>Mangler betaling</td>
    {% endif %}
{% endif %}
</tr>
</table>

{% with attendee_form.helper as helper %}
     {% uni_form attendee_form helper %}
{% endwith %}

</form>

<h3 id="billing">Betalinger</h3>

<table>
    <tr>
        <th colspan="2">Kvittering</th>
    </tr>

    {% for line in attendee.invoice.line_set.all %}
    <tr>
        <td>{{line.description}}</td><td>{{line.price}},-</td>
    </tr>
    {% endfor %}

    <tr>
        <td><b>Total</b></td>
        <td><b>{{attendee.invoice.total_price}},-</b></td>
    </tr>

    <tr>
        <th colspan="2">Betalinger</th>
    </tr>

    {% for payment in attendee.invoice.payment_set.all %}
    <tr>
        <td>{{payment.note}} ({{payment.created_date}} by {{payment.signee}})</td>
        <td>{{payment.amount}},-</td>
    </tr>
    {% endfor %}

    <tr>
        <td><b>Total betalt</b></td>
        <td><b>{{attendee.invoice.paid}},-</b></td>
    </tr>


    {% if not attendee.invoice.is_paid %}
    <tr>
        <td><b>Mangler betaling</b></td>
        <td><b>{{attendee.invoice.unpaid}},-</b></td>
    </tr>
    {% endif %}

    {% if attendee.invoice.is_overpaid %}
    <tr>
        <td><b>Total til udbetaling</b></td>
        <td><b>{{attendee.invoice.overpaid}},-</b></td>
    </tr>
    {% endif %}

</table>

{% with paymentform.helper as helper %}
     {% uni_form paymentform helper %}
{% endwith %}

<h3 id="selections">Tilvalg</h3>

<form method="POST" action="" class="uniForm">

{% for option_form in option_forms %}
    {% with option_form.helper as helper %}
         {% uni_form option_form helper %}
    {% endwith %}
{% endfor %}

{{ checkin_parts|safe }}

<div class="buttonHolder">
    <input type="submit" name="submit_option" value="Gem tilvalg" class="submit submitButton" id="submit-id-submit_option" />
</div>

</form>

{% endblock %}